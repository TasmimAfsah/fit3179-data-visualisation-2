<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Climate & Forest Dashboard 2020</title>
  <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
  <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 50%, #dee2e6 100%);
            min-height: 100vh;
            padding: 20px;
        }

        h2 {
            font-family: 'Times New Roman', Times, serif;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: transparent;
        }

        .header {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            color: #2c3e50;
            padding: 60px 30px;
            text-align: center;
            margin-bottom: 40px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border: 1px solid rgba(0,0,0,0.05);
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 300;
            font-family: 'Times New Roman', Times, serif;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .story-section {
            padding: 0;
            background: transparent;
            margin: 60px 0;
            text-align: center;
        }

        .story-paragraph {
            font-size: 1.3em;
            line-height: 2.0;
            margin: 30px auto;
            text-align: center;
            max-width: 900px;
            color: #495057;
            text-shadow: none;
            font-weight: 400;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .filters-section {
            background: rgba(255, 255, 255, 0.9);
            padding: 30px;
            margin: 40px 0;
            border-radius: 20px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.08);
            text-align: center;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(0,0,0,0.05);
        }

        .filter-group {
            display: inline-block;
            margin: 0 15px;
        }

        .filter-label {
            font-weight: 600;
            color: #2c3e50;
            margin-right: 8px;
        }

        .filter-select {
            padding: 8px 12px;
            border: 2px solid #3498db;
            border-radius: 5px;
            background: white;
            font-size: 14px;
            min-width: 150px;
        }

        .compact-dashboard {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .dashboard-row {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
            align-items: start;
        }

        .dashboard-row:last-child {
            grid-template-columns: 1fr;
        }

        .analysis-section {
            display: grid;
            grid-template-columns: 3fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
            align-items: start;
        }

        .main-chart-container {
            min-height: 550px;
            width: 100%;
        }

        .analysis-section .main-chart-container {
            display: flex;
            flex-direction: column;
        }

        .forest-analysis-section {
            display: flex;
            flex-direction: column;
            gap: 30px;
            margin-bottom: 30px;
        }

        .forest-chart-container {
            display: grid;
            grid-template-columns: 3fr 1fr;
            gap: 30px;
            margin-bottom: 20px;
            align-items: start;
        }

        .insights-sidebar {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .large-chart {
            min-height: 500px;
        }

        .medium-chart {
            min-height: 400px;
        }

        .chart-card {
            padding: 20px;
        }

        .large-chart #scatter,
        .large-chart #timeseries {
            width: 100%;
            height: 450px;
        }

        .medium-chart #donut {
            width: 100%;
            height: 350px;
        }

        /* Ensure Vega-Lite charts fill their containers */
        .vega-embed {
            width: 100% !important;
        }

        .vega-embed summary {
            display: none !important;
        }

        .vega-embed .vega-actions {
            display: none !important;
        }

        /* Make charts responsive */
        .chart-card svg {
            width: 100% !important;
            height: auto !important;
        }

        .large-chart svg {
            max-width: 100%;
            height: 450px !important;
        }

        .medium-chart svg {
            max-width: 100%;
            height: 350px !important;
        }

        .chart-header {
            margin-bottom: 20px;
        }

        .chart-filters {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        .chart-filter {
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 6px 12px;
            font-size: 0.85em;
            color: #495057;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .chart-filter:hover {
            background: rgba(52, 152, 219, 0.1);
            border-color: #3498db;
        }

        .chart-filter:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }

        .main-visualization {
            min-height: 500px;
        }

        .side-panel {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .map-toggle {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
            gap: 10px;
        }

        .toggle-btn {
            background: rgba(255, 255, 255, 0.9);
            border: 2px solid #dee2e6;
            border-radius: 25px;
            padding: 10px 20px;
            font-size: 0.9em;
            font-weight: 600;
            color: #495057;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .toggle-btn:hover {
            background: rgba(52, 152, 219, 0.1);
            border-color: #3498db;
            color: #2c3e50;
        }

        .toggle-btn.active {
            background: #3498db;
            border-color: #3498db;
            color: white;
        }


        .main-chart {
            grid-column: 1;
            grid-row: 1 / 3;
        }

        .side-cards {
            grid-column: 2;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border-left: 5px solid #3498db;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.15);
        }

        .card-title {
            font-size: 1.4em;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }

        .card-icon {
            font-size: 1.5em;
            margin-right: 10px;
        }

        .card-content {
            font-size: 1.1em;
            line-height: 1.6;
            color: #555;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 20px;
        }

        .stat-item {
            text-align: center;
            padding: 15px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 10px;
        }

        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #3498db;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9em;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .chart-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            margin: 60px 0;
        }

        .chart-card {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
            transition: transform 0.3s ease;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(0,0,0,0.05);
        }

        .chart-card:hover {
            transform: translateY(-3px);
        }

        .deforestation-card {
            background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
            color: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 15px 35px rgba(108, 117, 125, 0.3);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border: none;
            position: relative;
            overflow: hidden;
        }

        .deforestation-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 45px rgba(108, 117, 125, 0.4);
        }

        .deforestation-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #17a2b8, #138496, #117a8b);
        }

        .deforestation-title {
            font-size: 1.6em;
            font-weight: 700;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .deforestation-icon {
            font-size: 1.8em;
            margin-right: 12px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .deforestation-description {
            font-size: 1.1em;
            opacity: 0.9;
            margin-bottom: 20px;
            font-weight: 300;
        }

        .deforestation-chart {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            backdrop-filter: blur(10px);
        }

        .deforestation-poster {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-top: 20px;
        }

        .country-item {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            transition: transform 0.3s ease, background 0.3s ease;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        .country-item:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.25);
        }

        .country-rank {
            font-size: 2.5em;
            font-weight: 900;
            color: #ffc107;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
            margin-bottom: 10px;
        }

        .country-name {
            font-size: 1.2em;
            font-weight: 600;
            margin-bottom: 8px;
            text-shadow: 0 1px 2px rgba(0,0,0,0.3);
        }

        .country-value {
            font-size: 1.4em;
            font-weight: 700;
            color: #ecf0f1;
            text-shadow: 0 1px 2px rgba(0,0,0,0.3);
        }

        .country-unit {
            font-size: 0.9em;
            opacity: 0.8;
            margin-left: 5px;
        }

        .full-width {
            grid-column: 1 / -1;
        }

        .highlight-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            margin: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .highlight-number {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .highlight-text {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .chart-container {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(0,0,0,0.05);
        }

        .chart-container:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .chart-title {
            font-size: 1.3em;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 15px;
            text-align: center;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
            font-family: 'Times New Roman', Times, serif;
        }

        .chart-description {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 15px;
            text-align: center;
            font-style: italic;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .insights {
            background: rgba(255, 255, 255, 0.9);
            color: #2c3e50;
            padding: 40px;
            margin: 60px 0;
            border-radius: 20px;
            border-left: 5px solid #6c757d;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(0,0,0,0.05);
        }

        .insights h3 {
            font-size: 1.5em;
            margin-bottom: 15px;
            text-align: center;
            color: #2c3e50;
        }

        .insights ul {
            list-style: none;
            padding: 0;
        }

        .insights li {
            padding: 8px 0;
            border-bottom: 1px solid rgba(52, 73, 94, 0.1);
            color: #34495e;
        }

        .insights li:before {
            content: "• ";
            margin-right: 10px;
            color: #6c757d;
            font-weight: bold;
        }

        .footer {
            background: rgba(255, 255, 255, 0.9);
            color: #495057;
            padding: 40px;
            text-align: center;
            font-size: 0.9em;
            margin-top: 80px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(0,0,0,0.05);
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }

        .temperature-count-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            margin-top: 20px;
        }

        .temp-range-item {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 12px;
            padding: 15px;
            text-align: center;
            border: 2px solid #dee2e6;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .temp-range-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }

        .temp-range-label {
            font-size: 0.9em;
            font-weight: 600;
            color: #495057;
            margin-bottom: 8px;
            font-family: 'Times New Roman', Times, serif;
        }

        .temp-range-count {
            font-size: 1.8em;
            font-weight: 900;
            color: #6c757d;
            margin-bottom: 3px;
        }

        .temp-range-percentage {
            font-size: 0.8em;
            color: #6c757d;
            font-weight: 500;
        }

        .stats-card {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            border: 1px solid rgba(0,0,0,0.05);
            display: flex;
            justify-content: space-around;
        }

        .insights-compact {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            border: 1px solid rgba(0,0,0,0.05);
        }

        .insights-compact h3 {
            font-size: 1.2em;
            margin-bottom: 15px;
            color: #2c3e50;
            font-family: 'Times New Roman', Times, serif;
        }

        .insights-compact ul {
            list-style: none;
            padding: 0;
        }

        .insights-compact li {
            padding: 8px 0;
            border-bottom: 1px solid rgba(52, 73, 94, 0.1);
            color: #34495e;
            font-size: 0.9em;
        }

        .insights-compact li:before {
            content: "• ";
            margin-right: 8px;
            color: #6c757d;
            font-weight: bold;
        }

        .deforestation-alert {
            background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
            color: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(108, 117, 125, 0.3);
            margin-top: 20px;
        }

        .alert-header {
            display: flex;
            align-items: center;
            margin-bottom: 25px;
            text-align: center;
            justify-content: center;
        }

        .alert-icon {
            font-size: 1.5em;
            margin-right: 10px;
            animation: pulse 2s infinite;
        }

        .alert-header h3 {
            font-size: 1.4em;
            font-weight: 700;
            margin: 0;
            font-family: 'Times New Roman', Times, serif;
        }

        .deforestation-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
        }

        .deforestation-grid .country-item {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            transition: transform 0.3s ease, background 0.3s ease;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        .deforestation-grid .country-item:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.25);
        }

        .deforestation-grid .country-rank {
            font-size: 2em;
            font-weight: 900;
            color: #ffc107;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
            margin-bottom: 10px;
        }

        .deforestation-grid .country-name {
            font-size: 1.1em;
            font-weight: 600;
            margin-bottom: 8px;
            text-shadow: 0 1px 2px rgba(0,0,0,0.3);
        }

        .deforestation-grid .country-value {
            font-size: 1.2em;
            font-weight: 700;
            color: #ecf0f1;
            text-shadow: 0 1px 2px rgba(0,0,0,0.3);
        }

        @media (max-width: 768px) {
            .compact-dashboard {
                padding: 10px;
            }
            
            .dashboard-row {
                grid-template-columns: 1fr;
                gap: 20px;
                margin-bottom: 20px;
            }
            
            .analysis-section {
                grid-template-columns: 1fr;
                gap: 20px;
                margin-bottom: 20px;
            }
            
            .chart-filters {
                flex-direction: column;
                gap: 8px;
            }
            
            .chart-filter {
                width: 100%;
            }
            
            .deforestation-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }
            
            .stats-card {
                flex-direction: column;
                gap: 15px;
            }
            
            .header h1 {
                font-size: 2em;
            }
        }
  </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🌍 Climate & Forest Dashboard 2020</h1>
            <p>Comprehensive Analysis of Global Temperature Patterns and Forest Conservation</p>
        </div>

        <!-- Story Section 1: Introduction -->
        <div class="story-section">
            <h2 style="text-align: center; color: #2c3e50; margin-bottom: 30px;">🌡️ The Global Climate Story</h2>
            <div class="story-paragraph">
                Our planet's climate is changing rapidly. 
                Temperature patterns reveal dramatic variations 
                across different regions and countries. 
                Some areas experience extreme cold, 
                while others face scorching heat waves. 
                Understanding these patterns helps us 
                prepare for future environmental challenges.
            </div>
        </div>

        <!-- Highlight Box -->
        <div class="highlight-box">
            <div class="highlight-number">195</div>
            <div class="highlight-text">Countries Analyzed for Temperature & Forest Data</div>
        </div>

        <!-- Filters Section -->
        <div class="filters-section">
            <h3 style="margin-bottom: 20px; color: #2c3e50;">🔍 Interactive Filters</h3>
            <div class="filter-group">
                <label class="filter-label">Temperature Range:</label>
                <select class="filter-select" id="tempFilter">
                    <option value="all">All Temperatures</option>
                    <option value="cold">Below 10°C</option>
                    <option value="temperate">10-20°C</option>
                    <option value="warm">20-30°C</option>
                </select>
            </div>
            <div class="filter-group">
                <label class="filter-label">Forest Coverage:</label>
                <select class="filter-select" id="forestFilter">
                    <option value="all">All Forest Levels</option>
                    <option value="low">Low (0-20%)</option>
                    <option value="medium">Medium (20-50%)</option>
                    <option value="high">High (50%+)</option>
                </select>
            </div>
        </div>

        <!-- Compact Dashboard Layout -->
        <div class="compact-dashboard">
            
            <!-- Introduction -->
            <div class="story-section">
                <h2 style="text-align: center; color: #2c3e50; margin-bottom: 20px;">🌍 Global Climate & Forest Analysis</h2>
                <div class="story-paragraph">
                    Our planet's climate and forest systems 
                    are deeply interconnected across regions. 
                    Temperature patterns directly influence 
                    forest distribution and health worldwide. 
                    This interactive analysis reveals 
                    the complex relationships between 
                    climate zones and forest coverage, 
                    providing insights into environmental 
                    patterns and conservation needs.
                </div>
            </div>
            
            <!-- Row 1: Global Overview -->
            <div class="dashboard-row">
                <div class="main-visualization">
                    <!-- Map Toggle Buttons -->
                    <div class="map-toggle">
                        <button class="toggle-btn active" id="tempToggle">🌡️ Temperature</button>
                        <button class="toggle-btn" id="forestToggle">🌳 Forest Coverage</button>
                    </div>
                    
                    <!-- Temperature Map -->
                    <div class="chart-container" id="tempMapContainer">
                        <div class="chart-title">🌡️ Global Temperature Distribution</div>
                        <div class="chart-description">Average surface temperature by country in 2020</div>
                        <div id="choropleth">
                            <div class="loading">Loading choropleth map...</div>
                        </div>
                    </div>
                    
                    <!-- Forest Map -->
                    <div class="chart-container" id="forestMapContainer" style="display: none;">
                        <div class="chart-title">🌳 Global Forest Coverage</div>
                        <div class="chart-description">Forest proportion by country in 2020</div>
                        <div id="forest-choropleth">
                            <div class="loading">Loading forest map...</div>
                        </div>
                    </div>
                    
                    <!-- Stats below map -->
                    <div class="stats-card">
                        <div class="stat-item">
                            <div class="stat-number">195</div>
                            <div class="stat-label">Countries</div>
                        </div>
                        <div class="stat-item" id="tempStat">
                            <div class="stat-number">19.1°C</div>
                            <div class="stat-label">Avg Temp</div>
                        </div>
                        <div class="stat-item" id="forestStat" style="display: none;">
                            <div class="stat-number">31.2%</div>
                            <div class="stat-label">Avg Forest</div>
                        </div>
                    </div>
                </div>
                
                <div class="side-panel">
                    <div class="chart-card">
                        <div class="chart-title" id="rangeTitle">📊 Temperature Ranges</div>
                        <div id="temperature-count">
                            <div class="loading">Loading temperature data...</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Temperature Analysis Transition -->
            <div class="story-section">
                <div class="story-paragraph">
                    Temperature patterns create distinct 
                    climate zones across our planet. 
                    The interactive map reveals how 
                    temperature directly correlates with 
                    forest distribution patterns. 
                    Countries with moderate temperatures 
                    often support diverse forest ecosystems, 
                    while extreme climates face different 
                    environmental challenges and opportunities.
                </div>
            </div>

            <!-- Row 2: Temperature Analysis -->
            <div class="analysis-section">
                <div class="main-chart-container">
                    <div class="chart-card large-chart">
                        <div class="chart-header">
                            <div class="chart-title">🌳 Temperature vs Forest Coverage</div>
                            <div class="chart-description">Relationship between temperature and forest proportion</div>
                            <div class="chart-filters">
                                <select class="chart-filter" id="scatterTempFilter">
                                    <option value="all">All Temperatures</option>
                                    <option value="cold">Below 10°C</option>
                                    <option value="temperate">10-20°C</option>
                                    <option value="warm">20-30°C</option>
                                </select>
                                <select class="chart-filter" id="scatterForestFilter">
                                    <option value="all">All Forest Levels</option>
                                    <option value="low">Low (0-20%)</option>
                                    <option value="medium">Medium (20-50%)</option>
                                    <option value="high">High (50%+)</option>
                                </select>
                            </div>
                        </div>
                        <div id="scatter">
                            <div class="loading">Loading scatter plot...</div>
                        </div>
                    </div>
                </div>
                
                <div class="insights-sidebar">
                    <div class="insights-compact">
                        <h3>🌡️ Key Insights</h3>
                        <ul>
                            <li>118 countries (60%) experience warm temperatures (20-30°C)</li>
                            <li>Only 4 countries face extreme cold (below 0°C)</li>
                            <li>Temperature patterns correlate with forest coverage</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Forest Analysis Transition -->
            <div class="story-section">
                <div class="story-paragraph">
                    Forest coverage varies dramatically 
                    across different climate zones globally. 
                    The forest map reveals how 
                    environmental conditions shape 
                    forest distribution patterns. 
                    Some regions maintain extensive 
                    forest coverage while others face 
                    significant deforestation challenges. 
                    Understanding these patterns helps 
                    us develop targeted conservation strategies.
                </div>
            </div>

            <!-- Row 3: Forest Analysis -->
            <div class="forest-analysis-section">
                <div class="forest-chart-container">
                    <div class="chart-card large-chart">
                        <div class="chart-header">
                            <div class="chart-title">📈 Forest Area Evolution</div>
                            <div class="chart-description">Forest area changes from 1990 to 2020</div>
                            <div class="chart-filters">
                                <select class="chart-filter" id="timeseriesFilter">
                                    <option value="all">All Years</option>
                                    <option value="early">1990-2000</option>
                                    <option value="mid">2000-2010</option>
                                    <option value="recent">2010-2020</option>
                                </select>
                            </div>
                        </div>
                        <div id="timeseries">
                            <div class="loading">Loading time series...</div>
                        </div>
                    </div>
                    
                    <div class="insights-compact">
                        <h3>📈 Forest Evolution Insights</h3>
                        <ul>
                            <li>Global forest area decreased by 842 km² from 1990-2020</li>
                            <li>Steady decline of ~28 km² per year on average</li>
                            <li>Most significant loss occurred in 1990-2000 period</li>
                            <li>Conservation efforts showing some stabilization</li>
                        </ul>
                    </div>
                </div>
                
                <div class="forest-chart-container">
                    <div class="chart-card large-chart">
                    <div class="chart-header">
                        <div class="chart-title">🔥 Forest Fire Impact</div>
                        <div class="chart-description">Distribution of forest fire damage categories</div>
                    </div>
                        <div id="donut">
                            <div class="loading">Loading donut chart...</div>
                        </div>
                    </div>
                    
                    <div class="insights-compact">
                        <h3>🔥 Fire Impact Insights</h3>
                        <ul>
                            <li>Most countries experience low fire impact</li>
                            <li>Unknown impact data affects many regions</li>
                            <li>High impact fires concentrated in specific areas</li>
                            <li>Fire management strategies vary by region</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Deforestation Alert Transition -->
            <div class="story-section">
                <div class="story-paragraph">
                    Despite global forest conservation efforts, 
                    some countries continue experiencing 
                    severe deforestation at alarming rates. 
                    The data reveals which regions 
                    face the most critical challenges 
                    requiring immediate intervention. 
                    Understanding these patterns helps 
                    us prioritize resources and develop 
                    effective conservation strategies.
                </div>
            </div>

            <!-- Row 4: Deforestation Alert -->
            <div class="deforestation-alert">
                <div class="alert-header">
                    <span class="alert-icon">⚠️</span>
                    <h3>Top Deforestation Countries (2015-2020)</h3>
                </div>
                <div class="deforestation-grid">
                    <div class="country-item">
                        <div class="country-rank">1</div>
                        <div class="country-name">Brazil</div>
                        <div class="country-value">1,695.7 km²</div>
                    </div>
                    <div class="country-item">
                        <div class="country-rank">2</div>
                        <div class="country-name">India</div>
                        <div class="country-value">668.4 km²</div>
                    </div>
                    <div class="country-item">
                        <div class="country-rank">3</div>
                        <div class="country-name">Indonesia</div>
                        <div class="country-value">650.0 km²</div>
                    </div>
                    <div class="country-item">
                        <div class="country-rank">4</div>
                        <div class="country-name">Myanmar</div>
                        <div class="country-value">293.9 km²</div>
                    </div>
                    <div class="country-item">
                        <div class="country-rank">5</div>
                        <div class="country-name">Paraguay</div>
                        <div class="country-value">279.3 km²</div>
                    </div>
                    <div class="country-item">
                        <div class="country-rank">6</div>
                        <div class="country-name">Mozambique</div>
                        <div class="country-value">267.0 km²</div>
                    </div>
                </div>
            </div>

            <!-- Conclusion -->
            <div class="story-section">
                <div class="story-paragraph">
                    This interactive analysis demonstrates 
                    the powerful relationship between 
                    climate patterns and forest distribution. 
                    The dual-map visualization reveals 
                    how temperature zones directly influence 
                    forest coverage across regions. 
                    By understanding these interconnected 
                    systems, we can develop more 
                    effective conservation strategies 
                    and climate adaptation measures.
                </div>
            </div>

        </div>



        <div class="footer">
            <p>Data Sources: Global temperature data (2020) | Forest conservation data (1990-2020)</p>
            <p>Visualization: Vega-Lite | Dashboard by TasmimAfsah</p>
        </div>
    </div>

  <script>
        // Function to load and render a visualization from JSON file
        async function loadVisualization(containerId, jsonFile) {
            try {
                const response = await fetch(jsonFile);
                const spec = await response.json();
                
                // Store original specification for filtering
                originalSpecs[containerId] = spec;
                
                await vegaEmbed(`#${containerId}`, spec, { actions: false });
            } catch (error) {
                console.error(`Error loading ${jsonFile}:`, error);
                document.getElementById(containerId).innerHTML = 
                    `<p style="color:red">Failed to load ${jsonFile} — check console for details.</p>`;
            }
        }

        // Load all visualizations
        async function loadAllVisualizations() {
            const visualizations = [
                { id: 'choropleth', file: 'choropleth.json' },
                { id: 'forest-choropleth', file: 'forest_choropleth.json' },
                { id: 'scatter', file: 'scatter.json' },
                { id: 'timeseries', file: 'timeseries.json' },
                { id: 'donut', file: 'donut.json' }
            ];

            // Load all visualizations in parallel
            await Promise.all(
                visualizations.map(viz => loadVisualization(viz.id, viz.file))
            );
            
            // Load temperature count data
            await loadTemperatureCount();
            
            // Initialize map toggle functionality
            initializeMapToggle();
        }

        // Load temperature count data
        async function loadTemperatureCount() {
            try {
                const response = await fetch('temps_2020_clean.csv');
                const csvText = await response.text();
                const lines = csvText.split('\n');
                const data = lines.slice(1).filter(line => line.trim()).map(line => {
                    const [entity, code, avgTemp] = line.split(',');
                    return { entity, code, avgTemp: parseFloat(avgTemp) };
                });

                updateTemperatureCount(data);
            } catch (error) {
                console.error('Error loading temperature data:', error);
                document.getElementById('temperature-count').innerHTML = 
                    '<p style="color:red">Failed to load temperature data</p>';
            }
        }

        // Load forest count data
        async function loadForestCount() {
            try {
                const response = await fetch('temps_forest_2020_clean.csv');
                const csvText = await response.text();
                const lines = csvText.split('\n');
                const data = lines.slice(1).filter(line => line.trim()).map(line => {
                    const columns = line.split(',');
                    const entity = columns[0];
                    const code = columns[1];
                    const forestProp = parseFloat(columns[2]);
                    return { entity, code, forestProp };
                });

                updateForestCount(data);
            } catch (error) {
                console.error('Error loading forest data:', error);
                document.getElementById('temperature-count').innerHTML = 
                    '<p style="color:red">Failed to load forest data</p>';
            }
        }

        // Update forest count display
        function updateForestCount(data) {
            const ranges = {
                '0-20%': data.filter(d => d.forestProp >= 0 && d.forestProp < 20).length,
                '20-40%': data.filter(d => d.forestProp >= 20 && d.forestProp < 40).length,
                '40-60%': data.filter(d => d.forestProp >= 40 && d.forestProp < 60).length,
                '60%+': data.filter(d => d.forestProp >= 60).length
            };

            const total = data.length;
            
            const html = `
                <div class="temperature-count-grid">
                    <div class="temp-range-item">
                        <div class="temp-range-label">0-20%</div>
                        <div class="temp-range-count">${ranges['0-20%']}</div>
                        <div class="temp-range-percentage">${((ranges['0-20%'] / total) * 100).toFixed(1)}%</div>
                    </div>
                    <div class="temp-range-item">
                        <div class="temp-range-label">20-40%</div>
                        <div class="temp-range-count">${ranges['20-40%']}</div>
                        <div class="temp-range-percentage">${((ranges['20-40%'] / total) * 100).toFixed(1)}%</div>
                    </div>
                    <div class="temp-range-item">
                        <div class="temp-range-label">40-60%</div>
                        <div class="temp-range-count">${ranges['40-60%']}</div>
                        <div class="temp-range-percentage">${((ranges['40-60%'] / total) * 100).toFixed(1)}%</div>
                    </div>
                    <div class="temp-range-item">
                        <div class="temp-range-label">60%+</div>
                        <div class="temp-range-count">${ranges['60%+']}</div>
                        <div class="temp-range-percentage">${((ranges['60%+'] / total) * 100).toFixed(1)}%</div>
                    </div>
                </div>
            `;
            
            document.getElementById('temperature-count').innerHTML = html;
        }

        // Update temperature count display
        function updateTemperatureCount(data) {
            const ranges = {
                'Below 0°C': data.filter(d => d.avgTemp < 0).length,
                '0-10°C': data.filter(d => d.avgTemp >= 0 && d.avgTemp < 10).length,
                '10-20°C': data.filter(d => d.avgTemp >= 10 && d.avgTemp < 20).length,
                '20-30°C': data.filter(d => d.avgTemp >= 20 && d.avgTemp < 30).length
            };

            const total = data.length;
            
            const html = `
                <div class="temperature-count-grid">
                    <div class="temp-range-item">
                        <div class="temp-range-label">Below 0°C</div>
                        <div class="temp-range-count">${ranges['Below 0°C']}</div>
                        <div class="temp-range-percentage">${((ranges['Below 0°C'] / total) * 100).toFixed(1)}%</div>
                    </div>
                    <div class="temp-range-item">
                        <div class="temp-range-label">0-10°C</div>
                        <div class="temp-range-count">${ranges['0-10°C']}</div>
                        <div class="temp-range-percentage">${((ranges['0-10°C'] / total) * 100).toFixed(1)}%</div>
                    </div>
                    <div class="temp-range-item">
                        <div class="temp-range-label">10-20°C</div>
                        <div class="temp-range-count">${ranges['10-20°C']}</div>
                        <div class="temp-range-percentage">${((ranges['10-20°C'] / total) * 100).toFixed(1)}%</div>
                    </div>
                    <div class="temp-range-item">
                        <div class="temp-range-label">20-30°C</div>
                        <div class="temp-range-count">${ranges['20-30°C']}</div>
                        <div class="temp-range-percentage">${((ranges['20-30°C'] / total) * 100).toFixed(1)}%</div>
                    </div>
                </div>
            `;
            
            document.getElementById('temperature-count').innerHTML = html;
        }

        // Store original specifications
        let originalSpecs = {};

        // Filter functionality
        function applyFilters() {
            const tempFilter = document.getElementById('tempFilter').value;
            const forestFilter = document.getElementById('forestFilter').value;
            
            // Add visual feedback for active filters
            const filters = document.querySelectorAll('.filter-select');
            filters.forEach(filter => {
                if (filter.value !== 'all') {
                    filter.style.backgroundColor = '#e8f4fd';
                    filter.style.borderColor = '#2980b9';
                } else {
                    filter.style.backgroundColor = 'white';
                    filter.style.borderColor = '#3498db';
                }
            });
            
            // Apply filters to visualizations
            applyFiltersToVisualizations(tempFilter, forestFilter);
        }

        // Apply filters to specific visualizations
        function applyFiltersToVisualizations(tempFilter, forestFilter) {
            // Filter scatter plot
            if (originalSpecs.scatter) {
                const scatterSpec = JSON.parse(JSON.stringify(originalSpecs.scatter));
                const filters = [];
                
                if (tempFilter !== 'all') {
                    if (tempFilter === 'cold') {
                        filters.push({ "field": "AvgTemp", "range": [-50, 10] });
                    } else if (tempFilter === 'temperate') {
                        filters.push({ "field": "AvgTemp", "range": [10, 20] });
                    } else if (tempFilter === 'warm') {
                        filters.push({ "field": "AvgTemp", "range": [20, 50] });
                    }
                }
                
                if (forestFilter !== 'all') {
                    if (forestFilter === 'low') {
                        filters.push({ "field": "PropForest_2020", "range": [0, 20] });
                    } else if (forestFilter === 'medium') {
                        filters.push({ "field": "PropForest_2020", "range": [20, 50] });
                    } else if (forestFilter === 'high') {
                        filters.push({ "field": "PropForest_2020", "range": [50, 100] });
                    }
                }
                
                if (filters.length > 0) {
                    scatterSpec.transform = scatterSpec.transform || [];
                    scatterSpec.transform.push({ "filter": { "and": filters } });
                }
                
                vegaEmbed('#scatter', scatterSpec, { actions: false });
            }

            // Filter temperature choropleth map
            if (originalSpecs.choropleth) {
                const choroplethSpec = JSON.parse(JSON.stringify(originalSpecs.choropleth));
                const filters = [];
                
                if (tempFilter !== 'all') {
                    if (tempFilter === 'cold') {
                        filters.push({ "field": "AvgTemp", "range": [-50, 10] });
                    } else if (tempFilter === 'temperate') {
                        filters.push({ "field": "AvgTemp", "range": [10, 20] });
                    } else if (tempFilter === 'warm') {
                        filters.push({ "field": "AvgTemp", "range": [20, 50] });
                    }
                }
                
                if (filters.length > 0) {
                    choroplethSpec.transform = choroplethSpec.transform || [];
                    choroplethSpec.transform.push({ "filter": { "and": filters } });
                }
                
                vegaEmbed('#choropleth', choroplethSpec, { actions: false });
            }

            // Filter forest choropleth map
            if (originalSpecs['forest-choropleth']) {
                const forestChoroplethSpec = JSON.parse(JSON.stringify(originalSpecs['forest-choropleth']));
                const filters = [];
                
                if (forestFilter !== 'all') {
                    if (forestFilter === 'low') {
                        filters.push({ "field": "PropForest_2020", "range": [0, 20] });
                    } else if (forestFilter === 'medium') {
                        filters.push({ "field": "PropForest_2020", "range": [20, 50] });
                    } else if (forestFilter === 'high') {
                        filters.push({ "field": "PropForest_2020", "range": [50, 100] });
                    }
                }
                
                if (filters.length > 0) {
                    forestChoroplethSpec.transform = forestChoroplethSpec.transform || [];
                    forestChoroplethSpec.transform.push({ "filter": { "and": filters } });
                }
                
                vegaEmbed('#forest-choropleth', forestChoroplethSpec, { actions: false });
            }

            // Update temperature count with filters
            updateTemperatureCountWithFilters(tempFilter);
        }

        // Update temperature count with filters
        async function updateTemperatureCountWithFilters(tempFilter) {
            try {
                const response = await fetch('temps_2020_clean.csv');
                const csvText = await response.text();
                const lines = csvText.split('\n');
                let data = lines.slice(1).filter(line => line.trim()).map(line => {
                    const [entity, code, avgTemp] = line.split(',');
                    return { entity, code, avgTemp: parseFloat(avgTemp) };
                });

                // Apply temperature filter
                if (tempFilter !== 'all') {
                    if (tempFilter === 'cold') {
                        data = data.filter(d => d.avgTemp < 10);
                    } else if (tempFilter === 'temperate') {
                        data = data.filter(d => d.avgTemp >= 10 && d.avgTemp < 20);
                    } else if (tempFilter === 'warm') {
                        data = data.filter(d => d.avgTemp >= 20 && d.avgTemp < 30);
                    }
                }

                updateTemperatureCount(data);
            } catch (error) {
                console.error('Error updating temperature count:', error);
            }
        }

        // Add event listeners to filters
        function initializeFilters() {
            const filters = document.querySelectorAll('.filter-select');
            filters.forEach(filter => {
                filter.addEventListener('change', applyFilters);
            });

            // Initialize individual chart filters
            initializeChartFilters();
        }

        // Initialize individual chart filters
        function initializeChartFilters() {
            // Scatter plot filters
            const scatterTempFilter = document.getElementById('scatterTempFilter');
            const scatterForestFilter = document.getElementById('scatterForestFilter');
            
            if (scatterTempFilter) {
                scatterTempFilter.addEventListener('change', () => {
                    applyScatterFilters();
                });
            }
            
            if (scatterForestFilter) {
                scatterForestFilter.addEventListener('change', () => {
                    applyScatterFilters();
                });
            }

            // Time series filter
            const timeseriesFilter = document.getElementById('timeseriesFilter');
            if (timeseriesFilter) {
                timeseriesFilter.addEventListener('change', () => {
                    applyTimeseriesFilter();
                });
            }

        }

        // Apply scatter plot filters
        function applyScatterFilters() {
            const tempFilter = document.getElementById('scatterTempFilter').value;
            const forestFilter = document.getElementById('scatterForestFilter').value;
            
            if (originalSpecs.scatter) {
                const scatterSpec = JSON.parse(JSON.stringify(originalSpecs.scatter));
                const filters = [];
                
                if (tempFilter !== 'all') {
                    if (tempFilter === 'cold') {
                        filters.push({ "field": "AvgTemp", "range": [-50, 10] });
                    } else if (tempFilter === 'temperate') {
                        filters.push({ "field": "AvgTemp", "range": [10, 20] });
                    } else if (tempFilter === 'warm') {
                        filters.push({ "field": "AvgTemp", "range": [20, 30] });
                    }
                }
                
                if (forestFilter !== 'all') {
                    if (forestFilter === 'low') {
                        filters.push({ "field": "PropForest_2020", "range": [0, 20] });
                    } else if (forestFilter === 'medium') {
                        filters.push({ "field": "PropForest_2020", "range": [20, 50] });
                    } else if (forestFilter === 'high') {
                        filters.push({ "field": "PropForest_2020", "range": [50, 100] });
                    }
                }
                
                if (filters.length > 0) {
                    scatterSpec.transform = scatterSpec.transform || [];
                    scatterSpec.transform.push({ "filter": { "and": filters } });
                }
                
                vegaEmbed('#scatter', scatterSpec, { actions: false });
            }
        }

        // Apply time series filter
        function applyTimeseriesFilter() {
            const filter = document.getElementById('timeseriesFilter').value;
            
            if (originalSpecs.timeseries) {
                const timeseriesSpec = JSON.parse(JSON.stringify(originalSpecs.timeseries));
                
                if (filter !== 'all') {
                    let yearRange;
                    if (filter === 'early') {
                        yearRange = [1990, 2000];
                    } else if (filter === 'mid') {
                        yearRange = [2000, 2010];
                    } else if (filter === 'recent') {
                        yearRange = [2010, 2020];
                    }
                    
                    if (yearRange) {
                        timeseriesSpec.transform = timeseriesSpec.transform || [];
                        timeseriesSpec.transform.push({ 
                            "filter": { "field": "Year", "range": yearRange } 
                        });
                    }
                }
                
                vegaEmbed('#timeseries', timeseriesSpec, { actions: false });
            }
        }


        // Initialize map toggle functionality
        function initializeMapToggle() {
            const tempToggle = document.getElementById('tempToggle');
            const forestToggle = document.getElementById('forestToggle');
            const tempMapContainer = document.getElementById('tempMapContainer');
            const forestMapContainer = document.getElementById('forestMapContainer');
            const tempStat = document.getElementById('tempStat');
            const forestStat = document.getElementById('forestStat');
            const rangeTitle = document.getElementById('rangeTitle');

            tempToggle.addEventListener('click', () => {
                // Update button states
                tempToggle.classList.add('active');
                forestToggle.classList.remove('active');
                
                // Show temperature map, hide forest map
                tempMapContainer.style.display = 'block';
                forestMapContainer.style.display = 'none';
                
                // Show temperature stat, hide forest stat
                tempStat.style.display = 'flex';
                forestStat.style.display = 'none';
                
                // Update range title and show temperature ranges
                rangeTitle.textContent = '📊 Temperature Ranges';
                loadTemperatureCount();
            });

            forestToggle.addEventListener('click', () => {
                // Update button states
                forestToggle.classList.add('active');
                tempToggle.classList.remove('active');
                
                // Show forest map, hide temperature map
                forestMapContainer.style.display = 'block';
                tempMapContainer.style.display = 'none';
                
                // Show forest stat, hide temperature stat
                forestStat.style.display = 'flex';
                tempStat.style.display = 'none';
                
                // Update range title and show forest ranges
                rangeTitle.textContent = '🌳 Forest Coverage Ranges';
                loadForestCount();
            });
        }

        // Initialize dashboard when page loads
        document.addEventListener('DOMContentLoaded', () => {
            loadAllVisualizations();
            initializeFilters();
    });
  </script>
</body>
</html>


