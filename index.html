<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Climate & Forest Dashboard 2020</title>
  <link rel="stylesheet" href="styles.css">
  <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üåç Climate & Forest Dashboard 2020</h1>
            <p>Comprehensive Analysis of Global Temperature Patterns and Forest Conservation</p>
        </div>

        <!-- Story Section 1: Introduction -->
        <div class="story-section">
            <h2>The Global Climate & Forest Story</h2>
            <div class="story-paragraph">
                Our planet's climate is changing rapidly, and understanding this change begins with data. In 2020, we analyzed temperature patterns and forest coverage across 195 countries, revealing dramatic variations that tell a compelling story about our environment. Temperature patterns create distinct climate zones, ranging from extreme cold to scorching heat, while forests serve as vital carbon sinks and biodiversity havens. This comprehensive analysis explores how temperature and forest coverage are interconnected, and what these patterns reveal about the state of our planet.
            </div>
        </div>

        <!-- Highlight Box -->
        <div class="highlight-box">
            <div class="highlight-number">195</div>
            <div class="highlight-text">Countries Analyzed for Temperature & Forest Data in 2020</div>
        </div>

        <!-- Compact Dashboard Layout -->
        <div class="compact-dashboard">
            
            <!-- Section: Explore the Global Maps -->
            <div class="story-section">
                <h2>Explore the Global Maps</h2>
                <div class="story-paragraph">
                    The world's climate varies dramatically from region to region. Our interactive maps reveal temperature distributions and forest coverage patterns across all continents. Use the toggle buttons to switch between temperature and forest views, and apply filters to focus on specific ranges. Notice how certain temperature zones correlate with forest density patterns.
                </div>
            </div>
            
            <!-- Filters Section - Now closer to maps -->
            <div class="filters-section">
                <h3 style="margin-bottom: 18px; color: #2c3e50; font-size: 1.4em;">üîç Interactive Filters</h3>
                <div class="filter-group">
                    <label class="filter-label">Temperature Range:</label>
                    <select class="filter-select" id="tempFilter">
                        <option value="all">All Temperatures</option>
                        <option value="cold">Below 10¬∞C</option>
                        <option value="temperate">10-20¬∞C</option>
                        <option value="warm">20-30¬∞C</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label class="filter-label">Forest Coverage:</label>
                    <select class="filter-select" id="forestFilter">
                        <option value="all">All Forest Levels</option>
                        <option value="low">Low (0-20%)</option>
                        <option value="medium">Medium (20-50%)</option>
                        <option value="high">High (50%+)</option>
                    </select>
                </div>
            </div>
            
            <!-- Row 1: Global Overview -->
            <div class="dashboard-row">
                <div class="main-visualization">
                    <!-- Map Toggle Buttons -->
                    <div class="map-toggle">
                        <button class="toggle-btn active" id="tempToggle">üå°Ô∏è Temperature</button>
                        <button class="toggle-btn" id="forestToggle">üå≥ Forest Coverage</button>
                    </div>
                    
                    <!-- Temperature Map -->
                    <div class="chart-container" id="tempMapContainer">
                        <div class="chart-title">üå°Ô∏è Global Temperature Distribution</div>
                        <div class="chart-description">Average surface temperature by country in 2020</div>
                        <div id="choropleth">
                            <div class="loading">Loading choropleth map...</div>
                        </div>
                    </div>
                    
                    <!-- Forest Map -->
                    <div class="chart-container" id="forestMapContainer" style="display: none;">
                        <div class="chart-title">üå≥ Global Forest Coverage</div>
                        <div class="chart-description">Forest proportion by country in 2020</div>
                        <div id="forest-choropleth">
                            <div class="loading">Loading forest map...</div>
                        </div>
                    </div>
                    
                    <!-- Stats below map -->
                    <div class="stats-card">
                        <div class="stat-item">
                            <div class="stat-number">195</div>
                            <div class="stat-label">Countries</div>
                        </div>
                        <div class="stat-item" id="tempStat">
                            <div class="stat-number">19.1¬∞C</div>
                            <div class="stat-label">Avg Temp</div>
                        </div>
                        <div class="stat-item" id="forestStat" style="display: none;">
                            <div class="stat-number">31.2%</div>
                            <div class="stat-label">Avg Forest</div>
                        </div>
                    </div>
                </div>
                
                <div class="side-panel">
                    <div class="chart-card">
                        <div class="chart-title" id="rangeTitle">üìä Temperature Ranges</div>
                        <div id="temperature-count">
                            <div class="loading">Loading temperature data...</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Temperature Analysis Transition -->
            <div class="story-section">
                <h2>Temperature and Forest Relationships</h2>
                <div class="story-paragraph">
                    Temperature patterns create distinct climate zones across our planet, and these zones have profound effects on forest ecosystems. The scatter plot below reveals fascinating correlations between average temperature and forest coverage. Countries with moderate temperatures (10-20¬∞C) often support diverse and dense forest ecosystems, while extreme climates‚Äîwhether too cold or too hot‚Äîpresent unique challenges for forest survival. Use the chart filters to explore specific temperature ranges and discover which countries maintain the highest forest coverage within each climate zone.
                </div>
            </div>

            <!-- Row 2: Temperature Analysis -->
            <div class="analysis-section">
                <div class="main-chart-container">
                    <div class="chart-card large-chart">
                        <div class="chart-header">
                            <div class="chart-title">Temperature vs Forest Coverage</div>
                            <div class="chart-description">Relationship between temperature and forest proportion</div>
                            <div class="chart-filters">
                                <select class="chart-filter" id="scatterTempFilter">
                                    <option value="all">All Temperatures</option>
                                    <option value="cold">Below 10¬∞C</option>
                                    <option value="temperate">10-20¬∞C</option>
                                    <option value="warm">20-30¬∞C</option>
                                </select>
                                <select class="chart-filter" id="scatterForestFilter">
                                    <option value="all">All Forest Levels</option>
                                    <option value="low">Low (0-20%)</option>
                                    <option value="medium">Medium (20-50%)</option>
                                    <option value="high">High (50%+)</option>
                                </select>
                            </div>
                        </div>
                        <div id="scatter">
                            <div class="loading">Loading scatter plot...</div>
                        </div>
                    </div>
                </div>
                
                <div class="insights-sidebar">
                    <div class="insights-compact">
                        <h3>Key Insights</h3>
                        <ul>
                            <li><strong>118 countries (60%)</strong> experience <strong>warm temperatures (20-30¬∞C)</strong></li>
                            <li>Only <strong>4 countries</strong> face <strong>extreme cold (below 0¬∞C)</strong></li>
                            <li><strong>Temperature patterns correlate</strong> with forest coverage</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Forest Analysis Transition -->
            <div class="story-section">
                <h2>Forest Evolution and Fire Impact</h2>
                <div class="story-paragraph">
                    Forest coverage varies dramatically across different climate zones globally. Over the past three decades (1990-2020), we've witnessed significant changes in global forest area. Some regions maintain extensive forest coverage while others face alarming deforestation rates. The charts below track the evolution of forest areas over time and examine the impact of forest fires on different regions. These visualizations reveal critical trends that inform conservation priorities and climate action strategies.
                </div>
            </div>

            <!-- Row 3: Forest Analysis -->
            <div class="forest-analysis-section">
                <div class="forest-chart-container">
                    <div class="chart-card large-chart">
                            <div class="chart-header">
                                <div class="chart-title">Forest Area Evolution</div>
                                <div class="chart-description">Forest area changes from 1990 to 2020 ‚Ä¢ Drag on overview chart to zoom ‚Ä¢ Double-click overview to reset ‚Ä¢ Hover for details</div>
                            </div>
                        <div id="timeseries">
                            <div class="loading">Loading time series...</div>
                        </div>
                    </div>
                    
                    <div class="insights-compact">
                        <h3>Forest Evolution Insights</h3>
                        <ul>
                            <li>Global forest area <strong>decreased by 842 km¬≤</strong> from <strong>1990-2020</strong></li>
                            <li><strong>Steady decline</strong> of <strong>~28 km¬≤ per year</strong> on average</li>
                            <li>Most significant loss occurred in <strong>1990-2000 period</strong></li>
                            <li><strong>Conservation efforts</strong> showing some stabilization</li>
                        </ul>
                    </div>
                </div>
                
                <div class="forest-chart-container">
                    <div class="chart-card large-chart">
                    <div class="chart-header">
                        <div class="chart-title">Forest Fire Impact</div>
                        <div class="chart-description">Distribution of forest fire damage categories ‚Ä¢ Hover to see percentages and details</div>
                    </div>
                        <div id="donut">
                            <div class="loading">Loading donut chart...</div>
                        </div>
                    </div>
                    
                    <div class="insights-compact">
                        <h3>Fire Impact Insights</h3>
                        <ul>
                            <li><strong>Most countries</strong> experience <strong>low fire impact</strong></li>
                            <li><strong>Unknown impact data</strong> affects many regions</li>
                            <li><strong>High impact fires</strong> concentrated in specific areas</li>
                            <li><strong>Fire management strategies</strong> vary by region</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Deforestation Alert Transition -->
            <div class="story-section">
                <h2>‚ö†Ô∏è Critical Deforestation Hotspots</h2>
                <div class="story-paragraph">
                    Despite global forest conservation efforts and increasing awareness of climate change, some countries continue experiencing severe deforestation at alarming rates. Between 2015 and 2020, six countries emerged as critical hotspots, losing thousands of square kilometers of forest area. Brazil leads this unfortunate list, having lost over 1,695 square kilometers‚Äîmore than double the loss of any other nation. These regions require immediate international attention, targeted intervention, and sustainable development strategies to reverse these devastating trends.
                </div>
            </div>

            <!-- Row 4: Deforestation Alert -->
            <div class="deforestation-alert">
                <div class="alert-header">
                    <span class="alert-icon">‚ö†Ô∏è</span>
                    <h3>Top Deforestation Countries (2015-2020)</h3>
                </div>
                <div class="deforestation-grid">
                    <div class="country-item">
                        <div class="country-rank">1</div>
                        <div class="country-name">Brazil</div>
                        <div class="country-value">1,695.7 km¬≤</div>
                    </div>
                    <div class="country-item">
                        <div class="country-rank">2</div>
                        <div class="country-name">India</div>
                        <div class="country-value">668.4 km¬≤</div>
                    </div>
                    <div class="country-item">
                        <div class="country-rank">3</div>
                        <div class="country-name">Indonesia</div>
                        <div class="country-value">650.0 km¬≤</div>
                    </div>
                    <div class="country-item">
                        <div class="country-rank">4</div>
                        <div class="country-name">Myanmar</div>
                        <div class="country-value">293.9 km¬≤</div>
                    </div>
                    <div class="country-item">
                        <div class="country-rank">5</div>
                        <div class="country-name">Paraguay</div>
                        <div class="country-value">279.3 km¬≤</div>
                    </div>
                    <div class="country-item">
                        <div class="country-rank">6</div>
                        <div class="country-name">Mozambique</div>
                        <div class="country-value">267.0 km¬≤</div>
                    </div>
                </div>
            </div>

            <!-- Conclusion -->
            <div class="story-section">
                <h2>üå± The Path Forward</h2>
                <div class="story-paragraph">
                    This comprehensive analysis demonstrates the powerful and intricate relationship between climate patterns and forest ecosystems. The data reveals clear patterns: temperature zones directly influence forest distribution, deforestation remains a critical challenge in specific regions, and fire impacts vary significantly across the globe. By understanding these interconnected systems through data visualization, we can develop more effective conservation strategies, prioritize resources for the most critical areas, and implement evidence-based climate adaptation measures. The future of our forests‚Äîand our planet‚Äîdepends on informed action based on comprehensive environmental data like what we've explored here today.
                </div>
            </div>

        </div>



        <div class="footer">
            <p>Data Sources: Global temperature data (2020) | Forest conservation data (1990-2020)</p>
            <p>Visualization: Vega-Lite | Dashboard by TasmimAfsah</p>
        </div>
    </div>

  <script>
        // Function to load and render a visualization from JSON file
        async function loadVisualization(containerId, jsonFile) {
            try {
                const response = await fetch(jsonFile);
                const spec = await response.json();
                
                // Store original specification for filtering
                originalSpecs[containerId] = spec;
                
                await vegaEmbed(`#${containerId}`, spec, { actions: false });
            } catch (error) {
                console.error(`Error loading ${jsonFile}:`, error);
                document.getElementById(containerId).innerHTML = 
                    `<p style="color:red">Failed to load ${jsonFile} ‚Äî check console for details.</p>`;
            }
        }

        // Load all visualizations
        async function loadAllVisualizations() {
            const visualizations = [
                { id: 'choropleth', file: 'choropleth.json' },
                { id: 'forest-choropleth', file: 'forest_choropleth.json' },
                { id: 'scatter', file: 'scatter.json' },
                { id: 'timeseries', file: 'timeseries.json' },
                { id: 'donut', file: 'donut.json' }
            ];

            // Load all visualizations in parallel
            await Promise.all(
                visualizations.map(viz => loadVisualization(viz.id, viz.file))
            );
            
            // Load temperature count data
            await loadTemperatureCount();
            
            // Initialize map toggle functionality
            initializeMapToggle();
        }

        // Load temperature count data
        async function loadTemperatureCount() {
            try {
                const response = await fetch('temps_2020_clean.csv');
                const csvText = await response.text();
                const lines = csvText.split('\n');
                const data = lines.slice(1).filter(line => line.trim()).map(line => {
                    const [entity, code, avgTemp] = line.split(',');
                    return { entity, code, avgTemp: parseFloat(avgTemp) };
                });

                updateTemperatureCount(data);
            } catch (error) {
                console.error('Error loading temperature data:', error);
                document.getElementById('temperature-count').innerHTML = 
                    '<p style="color:red">Failed to load temperature data</p>';
            }
        }

        // Load forest count data
        async function loadForestCount() {
            try {
                const response = await fetch('temps_forest_2020_clean.csv');
                const csvText = await response.text();
                const lines = csvText.split('\n');
                const data = lines.slice(1).filter(line => line.trim()).map(line => {
                    const columns = line.split(',');
                    const entity = columns[0];
                    const code = columns[1];
                    const forestProp = parseFloat(columns[2]);
                    return { entity, code, forestProp };
                });

                updateForestCount(data);
            } catch (error) {
                console.error('Error loading forest data:', error);
                document.getElementById('temperature-count').innerHTML = 
                    '<p style="color:red">Failed to load forest data</p>';
            }
        }

        // Update forest count display
        function updateForestCount(data) {
            const ranges = {
                '0-20%': data.filter(d => d.forestProp >= 0 && d.forestProp < 20).length,
                '20-40%': data.filter(d => d.forestProp >= 20 && d.forestProp < 40).length,
                '40-60%': data.filter(d => d.forestProp >= 40 && d.forestProp < 60).length,
                '60%+': data.filter(d => d.forestProp >= 60).length
            };

            const total = data.length;
            
            const html = `
                <div class="temperature-count-grid">
                    <div class="temp-range-item">
                        <div class="temp-range-label">0-20%</div>
                        <div class="temp-range-count">${ranges['0-20%']}</div>
                        <div class="temp-range-percentage">${((ranges['0-20%'] / total) * 100).toFixed(1)}%</div>
                    </div>
                    <div class="temp-range-item">
                        <div class="temp-range-label">20-40%</div>
                        <div class="temp-range-count">${ranges['20-40%']}</div>
                        <div class="temp-range-percentage">${((ranges['20-40%'] / total) * 100).toFixed(1)}%</div>
                    </div>
                    <div class="temp-range-item">
                        <div class="temp-range-label">40-60%</div>
                        <div class="temp-range-count">${ranges['40-60%']}</div>
                        <div class="temp-range-percentage">${((ranges['40-60%'] / total) * 100).toFixed(1)}%</div>
                    </div>
                    <div class="temp-range-item">
                        <div class="temp-range-label">60%+</div>
                        <div class="temp-range-count">${ranges['60%+']}</div>
                        <div class="temp-range-percentage">${((ranges['60%+'] / total) * 100).toFixed(1)}%</div>
                    </div>
                </div>
            `;
            
            document.getElementById('temperature-count').innerHTML = html;
        }

        // Update temperature count display
        function updateTemperatureCount(data) {
            const ranges = {
                'Below 0¬∞C': data.filter(d => d.avgTemp < 0).length,
                '0-10¬∞C': data.filter(d => d.avgTemp >= 0 && d.avgTemp < 10).length,
                '10-20¬∞C': data.filter(d => d.avgTemp >= 10 && d.avgTemp < 20).length,
                '20-30¬∞C': data.filter(d => d.avgTemp >= 20 && d.avgTemp < 30).length
            };

            const total = data.length;
            
            const html = `
                <div class="temperature-count-grid">
                    <div class="temp-range-item">
                        <div class="temp-range-label">Below 0¬∞C</div>
                        <div class="temp-range-count">${ranges['Below 0¬∞C']}</div>
                        <div class="temp-range-percentage">${((ranges['Below 0¬∞C'] / total) * 100).toFixed(1)}%</div>
                    </div>
                    <div class="temp-range-item">
                        <div class="temp-range-label">0-10¬∞C</div>
                        <div class="temp-range-count">${ranges['0-10¬∞C']}</div>
                        <div class="temp-range-percentage">${((ranges['0-10¬∞C'] / total) * 100).toFixed(1)}%</div>
                    </div>
                    <div class="temp-range-item">
                        <div class="temp-range-label">10-20¬∞C</div>
                        <div class="temp-range-count">${ranges['10-20¬∞C']}</div>
                        <div class="temp-range-percentage">${((ranges['10-20¬∞C'] / total) * 100).toFixed(1)}%</div>
                    </div>
                    <div class="temp-range-item">
                        <div class="temp-range-label">20-30¬∞C</div>
                        <div class="temp-range-count">${ranges['20-30¬∞C']}</div>
                        <div class="temp-range-percentage">${((ranges['20-30¬∞C'] / total) * 100).toFixed(1)}%</div>
                    </div>
                </div>
            `;
            
            document.getElementById('temperature-count').innerHTML = html;
        }

        // Store original specifications
        let originalSpecs = {};

        // Filter functionality
        function applyFilters() {
            const tempFilter = document.getElementById('tempFilter').value;
            const forestFilter = document.getElementById('forestFilter').value;
            
            // Add visual feedback for active filters
            const filters = document.querySelectorAll('.filter-select');
            filters.forEach(filter => {
                if (filter.value !== 'all') {
                    filter.style.backgroundColor = '#e8f4fd';
                    filter.style.borderColor = '#2980b9';
                } else {
                    filter.style.backgroundColor = 'white';
                    filter.style.borderColor = '#3498db';
                }
            });
            
            // Apply filters to visualizations
            applyFiltersToVisualizations(tempFilter, forestFilter);
        }

        // Apply filters to specific visualizations
        function applyFiltersToVisualizations(tempFilter, forestFilter) {
            // Filter scatter plot
            if (originalSpecs.scatter) {
                const scatterSpec = JSON.parse(JSON.stringify(originalSpecs.scatter));
                const filters = [];
                
                if (tempFilter !== 'all') {
                    if (tempFilter === 'cold') {
                        filters.push({ "field": "AvgTemp", "range": [-50, 10] });
                    } else if (tempFilter === 'temperate') {
                        filters.push({ "field": "AvgTemp", "range": [10, 20] });
                    } else if (tempFilter === 'warm') {
                        filters.push({ "field": "AvgTemp", "range": [20, 50] });
                    }
                }
                
                if (forestFilter !== 'all') {
                    if (forestFilter === 'low') {
                        filters.push({ "field": "PropForest_2020", "range": [0, 20] });
                    } else if (forestFilter === 'medium') {
                        filters.push({ "field": "PropForest_2020", "range": [20, 50] });
                    } else if (forestFilter === 'high') {
                        filters.push({ "field": "PropForest_2020", "range": [50, 100] });
                    }
                }
                
                if (filters.length > 0) {
                    scatterSpec.transform = scatterSpec.transform || [];
                    scatterSpec.transform.push({ "filter": { "and": filters } });
                }
                
                vegaEmbed('#scatter', scatterSpec, { actions: false });
            }

            // Filter temperature choropleth map
            if (originalSpecs.choropleth) {
                const choroplethSpec = JSON.parse(JSON.stringify(originalSpecs.choropleth));
                const filters = [];
                
                if (tempFilter !== 'all') {
                    if (tempFilter === 'cold') {
                        filters.push({ "field": "AvgTemp", "range": [-50, 10] });
                    } else if (tempFilter === 'temperate') {
                        filters.push({ "field": "AvgTemp", "range": [10, 20] });
                    } else if (tempFilter === 'warm') {
                        filters.push({ "field": "AvgTemp", "range": [20, 50] });
                    }
                }
                
                if (filters.length > 0) {
                    choroplethSpec.transform = choroplethSpec.transform || [];
                    choroplethSpec.transform.push({ "filter": { "and": filters } });
                }
                
                vegaEmbed('#choropleth', choroplethSpec, { actions: false });
            }

            // Filter forest choropleth map
            if (originalSpecs['forest-choropleth']) {
                const forestChoroplethSpec = JSON.parse(JSON.stringify(originalSpecs['forest-choropleth']));
                const filters = [];
                
                if (forestFilter !== 'all') {
                    if (forestFilter === 'low') {
                        filters.push({ "field": "PropForest_2020", "range": [0, 20] });
                    } else if (forestFilter === 'medium') {
                        filters.push({ "field": "PropForest_2020", "range": [20, 50] });
                    } else if (forestFilter === 'high') {
                        filters.push({ "field": "PropForest_2020", "range": [50, 100] });
                    }
                }
                
                if (filters.length > 0) {
                    forestChoroplethSpec.transform = forestChoroplethSpec.transform || [];
                    forestChoroplethSpec.transform.push({ "filter": { "and": filters } });
                }
                
                vegaEmbed('#forest-choropleth', forestChoroplethSpec, { actions: false });
            }

            // Update temperature count with filters
            updateTemperatureCountWithFilters(tempFilter);
        }

        // Update temperature count with filters
        async function updateTemperatureCountWithFilters(tempFilter) {
            try {
                const response = await fetch('temps_2020_clean.csv');
                const csvText = await response.text();
                const lines = csvText.split('\n');
                let data = lines.slice(1).filter(line => line.trim()).map(line => {
                    const [entity, code, avgTemp] = line.split(',');
                    return { entity, code, avgTemp: parseFloat(avgTemp) };
                });

                // Apply temperature filter
                if (tempFilter !== 'all') {
                    if (tempFilter === 'cold') {
                        data = data.filter(d => d.avgTemp < 10);
                    } else if (tempFilter === 'temperate') {
                        data = data.filter(d => d.avgTemp >= 10 && d.avgTemp < 20);
                    } else if (tempFilter === 'warm') {
                        data = data.filter(d => d.avgTemp >= 20 && d.avgTemp < 30);
                    }
                }

                updateTemperatureCount(data);
            } catch (error) {
                console.error('Error updating temperature count:', error);
            }
        }

        // Add event listeners to filters
        function initializeFilters() {
            const filters = document.querySelectorAll('.filter-select');
            filters.forEach(filter => {
                filter.addEventListener('change', applyFilters);
            });

            // Initialize individual chart filters
            initializeChartFilters();
        }

        // Initialize individual chart filters
        function initializeChartFilters() {
            // Scatter plot filters
            const scatterTempFilter = document.getElementById('scatterTempFilter');
            const scatterForestFilter = document.getElementById('scatterForestFilter');
            
            if (scatterTempFilter) {
                scatterTempFilter.addEventListener('change', () => {
                    applyScatterFilters();
                });
            }
            
            if (scatterForestFilter) {
                scatterForestFilter.addEventListener('change', () => {
                    applyScatterFilters();
                });
            }


        }

        // Apply scatter plot filters
        function applyScatterFilters() {
            const tempFilter = document.getElementById('scatterTempFilter').value;
            const forestFilter = document.getElementById('scatterForestFilter').value;
            
            if (originalSpecs.scatter) {
                const scatterSpec = JSON.parse(JSON.stringify(originalSpecs.scatter));
                const filters = [];
                
                if (tempFilter !== 'all') {
                    if (tempFilter === 'cold') {
                        filters.push({ "field": "AvgTemp", "range": [-50, 10] });
                    } else if (tempFilter === 'temperate') {
                        filters.push({ "field": "AvgTemp", "range": [10, 20] });
                    } else if (tempFilter === 'warm') {
                        filters.push({ "field": "AvgTemp", "range": [20, 30] });
                    }
                }
                
                if (forestFilter !== 'all') {
                    if (forestFilter === 'low') {
                        filters.push({ "field": "PropForest_2020", "range": [0, 20] });
                    } else if (forestFilter === 'medium') {
                        filters.push({ "field": "PropForest_2020", "range": [20, 50] });
                    } else if (forestFilter === 'high') {
                        filters.push({ "field": "PropForest_2020", "range": [50, 100] });
                    }
                }
                
                if (filters.length > 0) {
                    scatterSpec.transform = scatterSpec.transform || [];
                    scatterSpec.transform.push({ "filter": { "and": filters } });
                }
                
                vegaEmbed('#scatter', scatterSpec, { actions: false });
            }
        }



        // Initialize map toggle functionality
        function initializeMapToggle() {
            const tempToggle = document.getElementById('tempToggle');
            const forestToggle = document.getElementById('forestToggle');
            const tempMapContainer = document.getElementById('tempMapContainer');
            const forestMapContainer = document.getElementById('forestMapContainer');
            const tempStat = document.getElementById('tempStat');
            const forestStat = document.getElementById('forestStat');
            const rangeTitle = document.getElementById('rangeTitle');

            tempToggle.addEventListener('click', () => {
                // Update button states
                tempToggle.classList.add('active');
                forestToggle.classList.remove('active');
                
                // Show temperature map, hide forest map
                tempMapContainer.style.display = 'block';
                forestMapContainer.style.display = 'none';
                
                // Show temperature stat, hide forest stat
                tempStat.style.display = 'flex';
                forestStat.style.display = 'none';
                
                // Update range title and show temperature ranges
                rangeTitle.textContent = 'üìä Temperature Ranges';
                loadTemperatureCount();
            });

            forestToggle.addEventListener('click', () => {
                // Update button states
                forestToggle.classList.add('active');
                tempToggle.classList.remove('active');
                
                // Show forest map, hide temperature map
                forestMapContainer.style.display = 'block';
                tempMapContainer.style.display = 'none';
                
                // Show forest stat, hide temperature stat
                forestStat.style.display = 'flex';
                tempStat.style.display = 'none';
                
                // Update range title and show forest ranges
                rangeTitle.textContent = 'üå≥ Forest Coverage Ranges';
                loadForestCount();
            });
        }

        // Initialize dashboard when page loads
        document.addEventListener('DOMContentLoaded', () => {
            loadAllVisualizations();
            initializeFilters();
    });
  </script>
</body>
</html>


